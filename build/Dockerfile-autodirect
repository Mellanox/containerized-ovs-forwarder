FROM centos:centos7

ARG MLNX_OFED_RHEL_LIBS
ARG MLNX_OFED_VERSION

COPY rdma-core-5?mlnx1-1.${MLNX_OFED_VERSION}.x86_64.rpm /tmp
COPY libibverbs-5?mlnx1-1.${MLNX_OFED_VERSION}.x86_64.rpm /tmp
COPY mlnx-dpdk-20.11.0-1.${MLNX_OFED_VERSION}.x86_64.rpm /tmp
COPY openvswitch-2.14.1-1.${MLNX_OFED_VERSION}.x86_64.rpm /tmp

RUN yum install -y  python3-libs unbound-libs perl pciutils libnl3 numactl\
    python3 python3-six iproute hostname compat-openssl10 unbound logrotate\
    && yum install -y \
    /tmp/rdma-core-5?mlnx1-1.${MLNX_OFED_VERSION}.x86_64.rpm\
    /tmp/libibverbs-5?mlnx1-1.${MLNX_OFED_VERSION}.x86_64.rpm\
    /tmp/mlnx-dpdk-20.11.0-1.${MLNX_OFED_VERSION}.x86_64.rpm\
    /tmp/openvswitch-2.14.1-1.${MLNX_OFED_VERSION}.x86_64.rpm

RUN rm -f /tmp/*.rpm

LABEL ovs.forwarder-name="Containerized OVS Forwarder"

ADD ./entrypoint.sh /

ENTRYPOINT ["/entrypoint.sh"]
